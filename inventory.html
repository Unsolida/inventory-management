<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ទម្រង់បញ្ចូលសម្ភារៈទំនិញ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Khmer OS Siemreap', 'Khmer OS Battambang', 'Khmer OS', Arial, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .header {
            background: #4a5568;
            color: white;
            padding: 20px 30px;
            border-radius: 8px 8px 0 0;
        }
        
        .header h1 {
            font-size: 24px;
        }
        
        .form-section {
            padding: 30px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            color: #374151;
            font-size: 14px;
            font-weight: 500;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 14px;
            font-family: inherit;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #4a5568;
        }
        
        .btn {
            background: #4a5568;
            color: white;
            padding: 10px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }
        
        .btn:hover {
            background: #2d3748;
        }
        
        .import-section {
            padding: 30px;
            background: #f9fafb;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .import-section h2 {
            font-size: 18px;
            margin-bottom: 20px;
            color: #374151;
        }
        
        .import-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .import-box {
            background: white;
            padding: 20px;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
        }
        
        .import-box h3 {
            font-size: 16px;
            margin-bottom: 8px;
            color: #4a5568;
        }
        
        .import-box p {
            font-size: 13px;
            color: #6b7280;
            margin-bottom: 12px;
        }
        
        #pasteArea {
            width: 100%;
            margin-bottom: 12px;
            font-family: monospace;
            font-size: 12px;
            resize: vertical;
        }
        
        #fileStatus {
            margin-top: 10px;
            padding: 8px;
            border-radius: 4px;
            font-size: 13px;
        }
        
        #fileStatus.success {
            background: #d1fae5;
            color: #065f46;
        }
        
        #fileStatus.error {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .table-section {
            padding: 30px;
            overflow-x: auto;
        }
        
        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .table-header h2 {
            font-size: 18px;
            color: #374151;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        
        .btn-export {
            background: #059669;
        }
        
        .btn-export:hover {
            background: #047857;
        }
        
        .btn-clear {
            background: #dc2626;
        }
        
        .btn-clear:hover {
            background: #b91c1c;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1400px;
        }
        
        thead {
            background: #f9fafb;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
            font-size: 13px;
        }
        
        th {
            color: #374151;
            font-weight: 600;
            white-space: nowrap;
        }
        
        tbody tr:hover {
            background: #f9fafb;
        }
        
        .btn-delete {
            background: #dc2626;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .btn-delete:hover {
            background: #b91c1c;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #9ca3af;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ទម្រង់បញ្ចូលសម្ភារៈទំនិញ</h1>
        </div>
        
        <div class="form-section">
            <form id="dataForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="invoiceNum">លេខប័ណ្ណបញ្ចូលសម្ភារៈ ទំនិញ *</label>
                        <input type="text" id="invoiceNum" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="itemName">ឈ្មោះសញ្ញា ក្បួន ខ្នាត បរិក្ខារ ទំនិញ *</label>
                        <input type="text" id="itemName" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="itemType">ប្រភេទសម្ភារៈ ទំនិញ *</label>
                        <select id="itemType" required>
                            <option value="">-- ជ្រើសរើស --</option>
                            <option value="សម្ភារៈរៀន និងបង្រៀន">សម្ភារៈរៀន និងបង្រៀន</option>
                            <option value="កិច្ចដំណើរការរដ្ឋបាល">កិច្ចដំណើរការរដ្ឋបាល</option>
                            <option value="ការថែទាំ និងជួសជុលផ្សេងៗ">ការថែទាំ និងជួសជុលផ្សេងៗ</option>
                            <option value="ការចូលរៀនដោយសមធម៌និងបង្ការសិស្សបោះបង់">ការចូលរៀនដោយសមធម៌និងបង្ការសិស្សបោះបង់</option>
                            <option value="អប់រំបំណិនជីវិត កីឡា ការងារយុវជន និងកុមារ">អប់រំបំណិនជីវិត កីឡា ការងារយុវជន និងកុមារ</option>
                            <option value="ការកែលម្អបរិស្ថាន និងទីធ្លាកម្សាន្ត">ការកែលម្អបរិស្ថាន និងទីធ្លាកម្សាន្ត</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="unit">ឯកតាគិត *</label>
                        <input type="text" id="unit" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="qtyDoc">ចំនួនតាមសក្ខីបត្រ *</label>
                        <input type="number" id="qtyDoc" required step="0.01">
                    </div>
                    
                    <div class="form-group">
                        <label for="qtyReceived">បញ្ចូលពិតប្រាកដ *</label>
                        <input type="number" id="qtyReceived" required step="0.01">
                    </div>
                    
                    <div class="form-group">
                        <label for="unitPrice">ថ្លៃឯកតា *</label>
                        <input type="text" id="unitPrice" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="totalAmount">សរុបទឹកប្រាក់</label>
                        <input type="text" id="totalAmount" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="entryDate">កាលបរិច្ឆេទបញ្ជីបញ្ចូលសម្ភារៈ ទំនិញ *</label>
                        <input type="text" id="entryDate" required placeholder="DD/MMM/YYYY">
                    </div>
                    
                    <div class="form-group">
                        <label for="receivedFrom">បានទទួលពី/អ្នកផ្គត់ផ្គង់ *</label>
                        <input type="text" id="receivedFrom" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="docType">តាម (ប្រភេទសក្ខីបត្រដើម) *</label>
                        <select id="docType" required>
                            <option value="">-- ជ្រើសរើស --</option>
                            <option value="Invioce">Invioce</option>
                            <option value="លិខិតបញ្ជាទិញ">លិខិតបញ្ជាទិញ</option>
                            <option value="បង្កាន់ដៃ">បង្កាន់ដៃ</option>
                            <option value="ផ្សេងៗ">ផ្សេងៗ</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="docNum">លេខសក្ខីបត្រ *</label>
                        <input type="text" id="docNum" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="invoiceDate">កាលបរិច្ឆេទវិក្កយបត្រ *</label>
                        <input type="text" id="invoiceDate" required placeholder="DD/MMM/YYYY">
                    </div>
                    
                    <div class="form-group">
                        <label for="entryPerson">អ្នកបញ្ចូល *</label>
                        <input type="text" id="entryPerson" required>
                    </div>
                </div>
                
                <button type="submit" class="btn" style="margin-top: 20px;">បញ្ចូលទិន្នន័យ</button>
            </form>
        </div>
        
        <div class="import-section">
            <h2>នាំចូលទិន្នន័យ</h2>
            <div class="import-grid">
                <div class="import-box">
                    <h3>📂 នាំចូលពីឯកសារ CSV</h3>
                    <p>ជ្រើសរើសឯកសារ CSV</p>
                    <input type="file" id="fileInput" accept=".csv" style="display: none;">
                    <button class="btn" onclick="document.getElementById('fileInput').click()">ជ្រើសរើសឯកសារ</button>
                    <div id="fileStatus"></div>
                </div>
                
                <div class="import-box">
                    <h3>📋 បិទភ្ជាប់ទិន្នន័យពី Excel</h3>
                    <p>ចម្លងទិន្នន័យពី Excel ហើយបិទភ្ជាប់ទីនេះ</p>
                    <textarea id="pasteArea" placeholder="បិទភ្ជាប់ទិន្នន័យទីនេះ..." rows="4"></textarea>
                    <button class="btn" onclick="importFromPaste()">នាំចូលទិន្នន័យ</button>
                </div>
                
                <div class="import-box">
                    <h3>💾 ទាញយកទម្រង់គំរូ</h3>
                    <p>ទាញយកឯកសារគំរូសម្រាប់បំពេញទិន្នន័យ</p>
                    <button class="btn" onclick="downloadTemplate()">ទាញយកគំរូ</button>
                </div>
            </div>
        </div>
        
        <div class="table-section">
            <div class="table-header">
                <h2>តារាងទិន្នន័យ</h2>
                <div class="action-buttons">
                    <button class="btn btn-export" onclick="exportToExcel()">នាំចេញទៅ Excel</button>
                    <button class="btn btn-clear" onclick="clearAllData()">លុបទាំងអស់</button>
                </div>
            </div>
            
            <div id="tableContainer"></div>
        </div>
    </div>

    <script>
        let dataStore = [];
        
        function parseKhmerNumber(str) {
            if (!str) return 0;
            return parseFloat(str.toString().replace(/[,៛\s]/g, '')) || 0;
        }
        
        function formatKhmerCurrency(num) {
            return parseFloat(num).toLocaleString('en-US') + ' ៛';
        }
        
        document.getElementById('qtyReceived').addEventListener('input', calculateTotal);
        document.getElementById('unitPrice').addEventListener('input', calculateTotal);
        
        function calculateTotal() {
            const qty = parseFloat(document.getElementById('qtyReceived').value) || 0;
            const price = parseKhmerNumber(document.getElementById('unitPrice').value);
            document.getElementById('totalAmount').value = formatKhmerCurrency(qty * price);
        }
        
        function renderTable() {
            const container = document.getElementById('tableContainer');
            
            if (dataStore.length === 0) {
                container.innerHTML = '<div class="empty-state">មិនទាន់មានទិន្នន័យ</div>';
                return;
            }
            
            let html = `<table><thead><tr>
                <th>លេខប័ណ្ណបញ្ចូលសម្ភារៈ ទំនិញ</th>
                <th>ឈ្មោះសញ្ញា ក្បួន ខ្នាត បរិក្ខារ ទំនិញ</th>
                <th>ប្រភេទសម្ភារៈ ទំនិញ</th>
                <th>ឯកតាគិត</th>
                <th>ចំនួនតាមសក្ខីបត្រ</th>
                <th>បញ្ចូលពិតប្រាកដ</th>
                <th>ថ្លៃឯកតា</th>
                <th>សរុបទឹកប្រាក់</th>
                <th>កាលបរិច្ឆេទបញ្ជីបញ្ចូលសម្ភារៈ ទំនិញ</th>
                <th>បានទទួលពី/អ្នកផ្គត់ផ្គង់</th>
                <th>តាម (ប្រភេទសក្ខីបត្រដើម)</th>
                <th>លេខសក្ខីបត្រ</th>
                <th>កាលបរិច្ឆេទវិក្កយបត្រ</th>
                <th>អ្នកបញ្ចូល</th>
                <th>សកម្មភាព</th>
            </tr></thead><tbody>`;
            
            dataStore.forEach((e, i) => {
                html += `<tr>
                    <td>${e.invoiceNum}</td>
                    <td>${e.itemName}</td>
                    <td>${e.itemType}</td>
                    <td>${e.unit}</td>
                    <td>${e.qtyDoc}</td>
                    <td>${e.qtyReceived}</td>
                    <td>${e.unitPrice}</td>
                    <td>${e.totalAmount}</td>
                    <td>${e.entryDate}</td>
                    <td>${e.receivedFrom}</td>
                    <td>${e.docType}</td>
                    <td>${e.docNum}</td>
                    <td>${e.invoiceDate}</td>
                    <td>${e.entryPerson}</td>
                    <td><button class="btn-delete" onclick="deleteEntry(${i})">លុប</button></td>
                </tr>`;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }
        
        document.getElementById('dataForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            dataStore.push({
                invoiceNum: document.getElementById('invoiceNum').value,
                itemName: document.getElementById('itemName').value,
                itemType: document.getElementById('itemType').value,
                unit: document.getElementById('unit').value,
                qtyDoc: document.getElementById('qtyDoc').value,
                qtyReceived: document.getElementById('qtyReceived').value,
                unitPrice: document.getElementById('unitPrice').value,
                totalAmount: document.getElementById('totalAmount').value,
                entryDate: document.getElementById('entryDate').value,
                receivedFrom: document.getElementById('receivedFrom').value,
                docType: document.getElementById('docType').value,
                docNum: document.getElementById('docNum').value,
                invoiceDate: document.getElementById('invoiceDate').value,
                entryPerson: document.getElementById('entryPerson').value
            });
            
            renderTable();
            this.reset();
        });
        
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const status = document.getElementById('fileStatus');
            const reader = new FileReader();
            
            reader.onload = function(event) {
                try {
                    const lines = event.target.result.split('\n').filter(l => l.trim());
                    for (let i = 1; i < lines.length; i++) {
                        const vals = lines[i].split(',').map(v => v.trim().replace(/^"|"$/g, ''));
                        if (vals.length >= 14) {
                            dataStore.push({
                                invoiceNum: vals[0], itemName: vals[1], itemType: vals[2],
                                unit: vals[3], qtyDoc: vals[4], qtyReceived: vals[5],
                                unitPrice: vals[6], totalAmount: vals[7], entryDate: vals[8],
                                receivedFrom: vals[9], docType: vals[10], docNum: vals[11],
                                invoiceDate: vals[12], entryPerson: vals[13]
                            });
                        }
                    }
                    renderTable();
                    status.className = 'success';
                    status.textContent = '✓ នាំចូលជោគជ័យ';
                } catch (error) {
                    status.className = 'error';
                    status.textContent = '✗ កំហុស';
                }
            };
            reader.readAsText(file);
        });
        
        function importFromPaste() {
            const text = document.getElementById('pasteArea').value.trim();
            if (!text) return alert('សូមបិទភ្ជាប់ទិន្នន័យ');
            
            const lines = text.split('\n').filter(l => l.trim());
            let count = 0;
            
            lines.forEach(line => {
                const vals = line.split('\t');
                if (vals.length >= 15 && vals[0] !== 'ល.រ') {
                    dataStore.push({
                        invoiceNum: vals[1], itemName: vals[2], itemType: vals[3],
                        unit: vals[4], qtyDoc: vals[5], qtyReceived: vals[6],
                        unitPrice: vals[7], totalAmount: vals[8], entryDate: vals[9],
                        receivedFrom: vals[10], docType: vals[11], docNum: vals[12],
                        invoiceDate: vals[13], entryPerson: vals[14]
                    });
                    count++;
                }
            });
            
            renderTable();
            document.getElementById('pasteArea').value = '';
            alert(`✓ នាំចូលជោគជ័យ ${count} ជួរ`);
        }
        
        function downloadTemplate() {
            const csv = 'លេខប័ណ្ណបញ្ចូលសម្ភារៈ ទំនិញ,ឈ្មោះសញ្ញា ក្បួន ខ្នាត បរិក្ខារ ទំនិញ,ប្រភេទសម្ភារៈ ទំនិញ,ឯកតាគិត,ចំនួនតាមសក្ខីបត្រ,បញ្ចូលពិតប្រាកដ,ថ្លៃឯកតា,សរុបទឹកប្រាក់,កាលបរិច្ឆេទបញ្ជីបញ្ចូលសម្ភារៈ ទំនិញ,បានទទួលពី/អ្នកផ្គត់ផ្គង់,តាម (ប្រភេទសក្ខីបត្រដើម),លេខសក្ខីបត្រ,កាលបរិច្ឆេទវិក្កយបត្រ,អ្នកបញ្ចូល\n001,កាវបិតថ្លា ៥០មល,សម្ភារៈរៀន និងបង្រៀន,ដប,10,10,"5,000 ៛","50,000 ៛",11/Mar/2025,បណ្ណាគា ភ្នំស្រុក លក់សម្ភារៈការិយាល័យ,Invioce,00032,10/Mar/2025,ស្វាង មនោរម្យ';
            const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'template.csv';
            link.click();
        }
        
        function exportToExcel() {
            if (dataStore.length === 0) return alert('មិនមានទិន្នន័យ');
            
            let csv = 'លេខប័ណ្ណបញ្ចូលសម្ភារៈ ទំនិញ,ឈ្មោះសញ្ញា ក្បួន ខ្នាត បរិក្ខារ ទំនិញ,ប្រភេទសម្ភារៈ ទំនិញ,ឯកតាគិត,ចំនួនតាមសក្ខីបត្រ,បញ្ចូលពិតប្រាកដ,ថ្លៃឯកតា,សរុបទឹកប្រាក់,កាលបរិច្ឆេទបញ្ជីបញ្ចូលសម្ភារៈ ទំនិញ,បានទទួលពី/អ្នកផ្គត់ផ្គង់,តាម (ប្រភេទសក្ខីបត្រដើម),លេខសក្ខីបត្រ,កាលបរិច្ឆេទវិក្កយបត្រ,អ្នកបញ្ចូល\n';
            
            dataStore.forEach((e) => {
                csv += `"${e.invoiceNum}","${e.itemName}","${e.itemType}","${e.unit}","${e.qtyDoc}","${e.qtyReceived}","${e.unitPrice}","${e.totalAmount}","${e.entryDate}","${e.receivedFrom}","${e.docType}","${e.docNum}","${e.invoiceDate}","${e.entryPerson}"\n`;
            });
            
            const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `data_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }
        
        function deleteEntry(i) {
            if (confirm('តើអ្នកប្រាកដថាចង់លុបទេ?')) {
                dataStore.splice(i, 1);
                renderTable();
            }
        }
        
        function clearAllData() {
            if (confirm('តើអ្នកប្រាកដថាចង់លុបទាំងអស់ទេ?')) {
                dataStore = [];
                renderTable();
            }
        }
        
        renderTable();
    </script>
</body>
</html>