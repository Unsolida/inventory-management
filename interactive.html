<!DOCTYPE html>

<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>á‘á˜áŸ’ášá„áŸ‹á”á‰áŸ’á…áŸá‰áŸá˜áŸ’á—á¶ášáŸˆá‘áŸ†á“á·á‰</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
    body {
        font-family: 'Khmer OS Siemreap', 'Khmer OS Battambang', 'Khmer OS', Arial, sans-serif;
        background: #f5f5f5;
        padding: 20px;
    }
    
    .container {
        max-width: 1600px;
        margin: 0 auto;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .header {
        background: #4a5568;
        color: white;
        padding: 20px 30px;
        border-radius: 8px 8px 0 0;
    }
    
    .header h1 {
        font-size: 24px;
    }
    
    .form-section {
        padding: 30px;
        border-bottom: 1px solid #e5e7eb;
    }
    
    .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
    }
    
    .form-group label {
        display: block;
        margin-bottom: 6px;
        color: #374151;
        font-size: 14px;
        font-weight: 500;
    }
    
    .form-group input,
    .form-group select,
    .form-group textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #d1d5db;
        border-radius: 4px;
        font-size: 14px;
        font-family: inherit;
    }
    
    .form-group input:focus,
    .form-group select:focus {
        outline: none;
        border-color: #4a5568;
    }
    
    .import-section {
        padding: 30px;
        background: #f9fafb;
        border-bottom: 1px solid #e5e7eb;
    }
    
    .import-section h2 {
        font-size: 18px;
        margin-bottom: 20px;
        color: #374151;
    }
    
    .import-box {
        background: white;
        padding: 20px;
        border-radius: 6px;
        border: 1px solid #e5e7eb;
    }
    
    .import-box h3 {
        font-size: 16px;
        margin-bottom: 8px;
        color: #4a5568;
    }
    
    .import-box p {
        font-size: 13px;
        color: #6b7280;
        margin-bottom: 12px;
    }
    
    #pasteArea {
        width: 100%;
        height: 200px;
        margin-bottom: 12px;
        font-family: monospace;
        font-size: 12px;
        resize: vertical;
        padding: 10px;
        border: 2px dashed #d1d5db;
        border-radius: 4px;
    }
    
    .btn {
        background: #4a5568;
        color: white;
        padding: 10px 24px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
    }
    
    .btn:hover {
        background: #2d3748;
    }
    
    .btn-export {
        background: #059669;
    }
    
    .btn-export:hover {
        background: #047857;
    }
    
    .btn-clear {
        background: #dc2626;
    }
    
    .btn-clear:hover {
        background: #b91c1c;
    }
    
    #importStatus {
        margin-top: 10px;
        padding: 10px;
        border-radius: 4px;
        font-size: 13px;
        display: none;
    }
    
    #importStatus.success {
        background: #d1fae5;
        color: #065f46;
        display: block;
    }
    
    #importStatus.error {
        background: #fee2e2;
        color: #991b1b;
        display: block;
    }
    
    .table-section {
        padding: 30px;
        overflow-x: auto;
    }
    
    .table-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 10px;
    }
    
    .table-header h2 {
        font-size: 18px;
        color: #374151;
    }
    
    .action-buttons {
        display: flex;
        gap: 10px;
    }
    
    table {
        width: 100%;
        border-collapse: collapse;
        min-width: 1400px;
    }
    
    thead {
        background: #f9fafb;
    }
    
    th, td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #e5e7eb;
        font-size: 13px;
    }
    
    th {
        color: #374151;
        font-weight: 600;
        white-space: nowrap;
    }
    
    tbody tr:hover {
        background: #f9fafb;
    }
    
    .btn-delete {
        background: #dc2626;
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
    }
    
    .btn-delete:hover {
        background: #b91c1c;
    }
    
    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #9ca3af;
    }
    
    .empty-state-icon {
        font-size: 48px;
        margin-bottom: 10px;
    }
</style></head>
<body>
    <div class="container">
        <div class="header">
            <h1>á‘á˜áŸ’ášá„áŸ‹á”á‰áŸ’á…áŸá‰áŸá˜áŸ’á—á¶ášáŸˆá‘áŸ†á“á·á‰</h1>
        </div>
    <div class="form-section">
        <form id="dataForm">
            <div class="form-grid">
                <div class="form-group">
                    <label for="no">á›.áš *</label>
                    <input type="text" id="no" required>
                </div>
                
                <div class="form-group">
                    <label for="description">á”ášá·á™á¶á™ *</label>
                    <input type="text" id="description" required>
                </div>
                
                <div class="form-group">
                    <label for="unit">á¯á€áá¶á‚á·á *</label>
                    <input type="text" id="unit" required>
                </div>
                
                <div class="form-group">
                    <label for="qtyRequested">á…áŸ†á“á½á“áŸáŸ†áá¼á˜á–áš *</label>
                    <input type="number" id="qtyRequested" required>
                </div>
                
                <div class="form-group">
                    <label for="qtyActual">á…áŸ†á“á½á“á”á‰áŸ’á…áŸá‰á–á·á *</label>
                    <input type="number" id="qtyActual" required>
                </div>
                
                <div class="form-group">
                    <label for="unitPrice">áá˜áŸ’á›áŸƒášá¶á™ *</label>
                    <input type="number" id="unitPrice" required step="0.01">
                </div>
                
                <div class="form-group">
                    <label for="totalPrice">áá˜áŸ’á›áŸƒáŸášá»á”</label>
                    <input type="number" id="totalPrice" readonly step="0.01">
                </div>
                
                <div class="form-group">
                    <label for="receiptNo">á›áŸáá”áŸááŸ’áá”á‰áŸ’á…áŸá‰ *</label>
                    <input type="text" id="receiptNo" required>
                </div>
                
                <div class="form-group">
                    <label for="date">á€á¶á›á”ášá·á…áŸ’á†áŸá‘ *</label>
                    <input type="text" id="date" required>
                </div>
                
                <div class="form-group">
                    <label for="userName">áˆáŸ’á˜áŸ„áŸ‡ á“á·á„á•áŸ’á“áŸ‚á€á”áŸ’ášá¾á”áŸ’ášá¶áŸáŸ‹ *</label>
                    <input type="text" id="userName" required>
                </div>
                
                <div class="form-group">
                    <label for="category">á˜á»ááŸá‰áŸ’á‰á¶á”áŸ’ášá¾á”áŸ’ášá¶áŸáŸ‹ *</label>
                    <input type="text" id="category" required>
                </div>
                
                <div class="form-group">
                    <label for="referenceNo">á™áŸ„á„á–á¸á”áŸááŸ’áâ€‹á”á‰áŸ’á…á¼á› *</label>
                    <input type="text" id="referenceNo" required>
                </div>
            </div>
            
            <button type="submit" class="btn" style="margin-top: 20px;">á”á‰áŸ’á…á¼á›á‘á·á“áŸ’á“á“áŸá™</button>
        </form>
    </div>
    
    <div class="import-section">
        <h2>á“á¶áŸ†á…á¼á›á‘á·á“áŸ’á“á“áŸá™</h2>
        <div class="import-box">
            <h3>á”á·á‘á—áŸ’á‡á¶á”áŸ‹á‘á·á“áŸ’á“á“áŸá™á–á¸ Excel</h3>
            <p>á…á˜áŸ’á›á„á‘á·á“áŸ’á“á“áŸá™á‘á¶áŸ†á„á¢áŸáŸ‹á–á¸ Excel (ášá½á˜á‘á¶áŸ†á„á…áŸ†áá„á‡á¾á„) á á¾á™á”á·á‘á—áŸ’á‡á¶á”áŸ‹á‘á¸á“áŸáŸ‡</p>
            <textarea id="pasteArea" placeholder="á”á·á‘á—áŸ’á‡á¶á”áŸ‹á‘á·á“áŸ’á“á“áŸá™á‘á¸á“áŸáŸ‡...&#10;&#10;á§á‘á¶á ášááŸ:&#10;á›.áš á”ášá·á™á¶á™ á¯á€áá¶á‚á·á á…áŸ†á“á½á“áŸáŸ†áá¼á˜á–áš á…áŸ†á“á½á“á”á‰áŸ’á…áŸá‰á–á·á áá˜áŸ’á›áŸƒášá¶á™ áá˜áŸ’á›áŸƒáŸášá»á” ..."></textarea>
            <button class="btn" onclick="importFromPaste()">á“á¶áŸ†á…á¼á›á‘á·á“áŸ’á“á“áŸá™</button>
            <div id="importStatus"></div>
        </div>
    </div>
    
    <div class="table-section">
        <div class="table-header">
            <h2>áá¶ášá¶á„á‘á·á“áŸ’á“á“áŸá™ (<span id="recordCount">0</span> á€áŸ†áááŸ‹ááŸ’ášá¶)</h2>
            <div class="action-buttons">
                <button class="btn btn-export" onclick="exportToExcel()">á“á¶áŸ†á…áŸá‰á‘áŸ… Excel</button>
                <button class="btn btn-clear" onclick="clearAllData()">á›á»á”á‘á¶áŸ†á„á¢áŸáŸ‹</button>
            </div>
        </div>
        
        <div id="tableContainer"></div>
    </div>
</div>

<script>
    let dataStore = [];
    
    // Auto-calculate total
    document.getElementById('qtyActual').addEventListener('input', calculateTotal);
    document.getElementById('unitPrice').addEventListener('input', calculateTotal);
    
    function calculateTotal() {
        const qty = parseFloat(document.getElementById('qtyActual').value) || 0;
        const price = parseFloat(document.getElementById('unitPrice').value) || 0;
        document.getElementById('totalPrice').value = (qty * price).toFixed(2);
    }
    
    document.getElementById('dataForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        dataStore.push({
            no: document.getElementById('no').value,
            description: document.getElementById('description').value,
            unit: document.getElementById('unit').value,
            qtyRequested: document.getElementById('qtyRequested').value,
            qtyActual: document.getElementById('qtyActual').value,
            unitPrice: parseFloat(document.getElementById('unitPrice').value),
            totalPrice: parseFloat(document.getElementById('totalPrice').value),
            receiptNo: document.getElementById('receiptNo').value,
            date: document.getElementById('date').value,
            userName: document.getElementById('userName').value,
            category: document.getElementById('category').value,
            referenceNo: document.getElementById('referenceNo').value
        });
        
        renderTable();
        this.reset();
    });
    
    function parseKhmerNumber(str) {
        if (!str) return 0;
        const cleaned = str.toString().replace(/[áŸ›,\s]/g, '');
        const num = parseFloat(cleaned);
        return isNaN(num) ? 0 : num;
    }
    
    function formatKhmerCurrency(num) {
        return parseFloat(num).toLocaleString('en-US', {
            minimumFractionDigits: 0,
            maximumFractionDigits: 0
        }) + ' áŸ›';
    }
    
    function renderTable() {
        const container = document.getElementById('tableContainer');
        document.getElementById('recordCount').textContent = dataStore.length;
        
        if (dataStore.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">ğŸ“¦</div>
                    <div style="font-size: 16px; margin-bottom: 5px;">á˜á·á“á‘á¶á“áŸ‹á˜á¶á“á‘á·á“áŸ’á“á“áŸá™</div>
                    <div style="font-size: 13px;">áŸá¼á˜á”áŸ†á–áŸá‰á‘á˜áŸ’ášá„áŸ‹á¬á”á·á‘á—áŸ’á‡á¶á”áŸ‹á‘á·á“áŸ’á“á“áŸá™á–á¸ Excel</div>
                </div>
            `;
            return;
        }
        
        let html = `<table><thead><tr>
            <th>á›.áš</th>
            <th>á”ášá·á™á¶á™</th>
            <th>á¯á€áá¶á‚á·á</th>
            <th>á…áŸ†á“á½á“áŸáŸ†áá¼á˜á–áš</th>
            <th>á…áŸ†á“á½á“á”á‰áŸ’á…áŸá‰á–á·á</th>
            <th>áá˜áŸ’á›áŸƒášá¶á™</th>
            <th>áá˜áŸ’á›áŸƒáŸášá»á”</th>
            <th>á›áŸáá”áŸááŸ’áá”á‰áŸ’á…áŸá‰</th>
            <th>á€á¶á›á”ášá·á…áŸ’á†áŸá‘</th>
            <th>áˆáŸ’á˜áŸ„áŸ‡ á“á·á„á•áŸ’á“áŸ‚á€á”áŸ’ášá¾á”áŸ’ášá¶áŸáŸ‹</th>
            <th>á˜á»ááŸá‰áŸ’á‰á¶á”áŸ’ášá¾á”áŸ’ášá¶áŸáŸ‹</th>
            <th>á™áŸ„á„á–á¸á”áŸááŸ’áâ€‹á”á‰áŸ’á…á¼á›</th>
            <th>áŸá€á˜áŸ’á˜á—á¶á–</th>
        </tr></thead><tbody>`;
        
        dataStore.forEach((item, index) => {
            html += `<tr>
                <td>${item.no}</td>
                <td>${item.description}</td>
                <td>${item.unit}</td>
                <td>${item.qtyRequested}</td>
                <td>${item.qtyActual}</td>
                <td>${formatKhmerCurrency(item.unitPrice)}</td>
                <td>${formatKhmerCurrency(item.totalPrice)}</td>
                <td>${item.receiptNo}</td>
                <td>${item.date}</td>
                <td>${item.userName}</td>
                <td>${item.category}</td>
                <td>${item.referenceNo}</td>
                <td><button class="btn-delete" onclick="deleteEntry(${index})">á›á»á”</button></td>
            </tr>`;
        });
        
        html += '</tbody></table>';
        container.innerHTML = html;
    }
    
    function importFromPaste() {
        const text = document.getElementById('pasteArea').value.trim();
        const status = document.getElementById('importStatus');
        
        if (!text) {
            status.className = 'error';
            status.textContent = 'âš ï¸ áŸá¼á˜á”á·á‘á—áŸ’á‡á¶á”áŸ‹á‘á·á“áŸ’á“á“áŸá™';
            return;
        }
        
        try {
            const lines = text.split('\n').filter(l => l.trim());
            let imported = 0;
            let skipped = 0;
            
            lines.forEach((line, idx) => {
                const cols = line.split('\t');
                
                if (idx === 0 && (cols[0] === 'á›.áš' || cols[0].includes('á›.áš'))) {
                    return;
                }
                
                if (cols.length >= 12) {
                    dataStore.push({
                        no: cols[0] || '',
                        description: cols[1] || '',
                        unit: cols[2] || '',
                        qtyRequested: cols[3] || '',
                        qtyActual: cols[4] || '',
                        unitPrice: parseKhmerNumber(cols[5]),
                        totalPrice: parseKhmerNumber(cols[6]),
                        receiptNo: cols[7] || '',
                        date: cols[8] || '',
                        userName: cols[9] || '',
                        category: cols[10] || '',
                        referenceNo: cols[11] || ''
                    });
                    imported++;
                } else {
                    skipped++;
                }
            });
            
            renderTable();
            document.getElementById('pasteArea').value = '';
            
            status.className = 'success';
            status.textContent = `âœ… á“á¶áŸ†á…á¼á›á‡áŸ„á‚á‡áŸá™ ${imported} á€áŸ†áááŸ‹ááŸ’ášá¶` + 
                (skipped > 0 ? ` (ášáŸ†á›á„ ${skipped} á‡á½ášá˜á·á“ááŸ’ášá¹á˜ááŸ’ášá¼áœ)` : '');
            
        } catch (error) {
            status.className = 'error';
            status.textContent = 'âŒ á€áŸ†á á»áŸá€áŸ’á“á»á„á€á¶ášá“á¶áŸ†á…á¼á›: ' + error.message;
        }
    }
    
    function exportToExcel() {
        if (dataStore.length === 0) {
            alert('á˜á·á“á˜á¶á“á‘á·á“áŸ’á“á“áŸá™áŸá˜áŸ’ášá¶á”áŸ‹á“á¶áŸ†á…áŸá‰');
            return;
        }
        
        let csv = 'á›.áš\tá”ášá·á™á¶á™\tá¯á€áá¶á‚á·á\tá…áŸ†á“á½á“áŸáŸ†áá¼á˜á–áš\tá…áŸ†á“á½á“á”á‰áŸ’á…áŸá‰á–á·á\táá˜áŸ’á›áŸƒášá¶á™\táá˜áŸ’á›áŸƒáŸášá»á”\tá›áŸáá”áŸááŸ’áá”á‰áŸ’á…áŸá‰\tá€á¶á›á”ášá·á…áŸ’á†áŸá‘\táˆáŸ’á˜áŸ„áŸ‡ á“á·á„á•áŸ’á“áŸ‚á€á”áŸ’ášá¾á”áŸ’ášá¶áŸáŸ‹\tá˜á»ááŸá‰áŸ’á‰á¶á”áŸ’ášá¾á”áŸ’ášá¶áŸáŸ‹\tá™áŸ„á„á–á¸á”áŸááŸ’áâ€‹á”á‰áŸ’á…á¼á›\n';
        
        dataStore.forEach(item => {
            csv += `${item.no}\t${item.description}\t${item.unit}\t${item.qtyRequested}\t${item.qtyActual}\t${formatKhmerCurrency(item.unitPrice)}\t${formatKhmerCurrency(item.totalPrice)}\t${item.receiptNo}\t${item.date}\t${item.userName}\t${item.category}\t${item.referenceNo}\n`;
        });
        
        const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `data_export_${new Date().toISOString().split('T')[0]}.csv`;
        link.click();
        
        alert(`âœ… á“á¶áŸ†á…áŸá‰á‡áŸ„á‚á‡áŸá™ ${dataStore.length} á€áŸ†áááŸ‹ááŸ’ášá¶`);
    }
    
    function deleteEntry(index) {
        if (confirm('áá¾á¢áŸ’á“á€á”áŸ’ášá¶á€áŠáá¶á…á„áŸ‹á›á»á”á€áŸ†áááŸ‹ááŸ’ášá¶á“áŸáŸ‡á‘áŸ?')) {
            dataStore.splice(index, 1);
            renderTable();
        }
    }
    
    function clearAllData() {
        if (dataStore.length === 0) {
            alert('á˜á·á“á˜á¶á“á‘á·á“áŸ’á“á“áŸá™áŸá˜áŸ’ášá¶á”áŸ‹á›á»á”');
            return;
        }
        
        if (confirm(`áá¾á¢áŸ’á“á€á”áŸ’ášá¶á€áŠáá¶á…á„áŸ‹á›á»á”á‘á·á“áŸ’á“á“áŸá™á‘á¶áŸ†á„á¢áŸáŸ‹ (${dataStore.length} á€áŸ†áááŸ‹ááŸ’ášá¶) á‘áŸ?`)) {
            dataStore = [];
            renderTable();
            document.getElementById('importStatus').style.display = 'none';
        }
    }
    
    renderTable();
</script></body>
</html>
